<style type="text/css">
    body {
        margin: 0px;
        padding: 0px;
    }

    #divAuthorizeNetPopupScreen {
        left: 0px;
        top: 0px;
        width: 100%;
        height: 100%;
        z-index: 1;
        background-color: #808080;
        opacity: 0.5;
        -ms-filter: 'progid:DXImageTransform.Microsoft.Alpha(Opacity=50)';
        filter: alpha(opacity=50);
    }

    #divAuthorizeNetPopup {
        position: fixed;
        left: 50%;
        top: 50%;
        /*margin-left: -200px;*/
        /*margin-top: -200px;*/
        z-index: 2;
        overflow: visible;
        visibility: initial;
        margin-top: -400px;
        margin-left: -400px;
        transform: translate(0, 0) !important;
    }

    .AuthorizeNetPopupGrayFrameTheme .AuthorizeNetPopupOuter {
        background-color: #222d32;
        background-color: #ffffff;
        border-width: 1px;
        border-style: solid;
        border-color: #a0a0a0 #909090 #909090 #a0a0a0;
        padding: 4px;
    }

    .AuthorizeNetPopupGrayFrameTheme .AuthorizeNetPopupTop {
        height: 23px;
        position: absolute;
        top: 0;
        width: 100%;
        left: 0;
    }

    .AuthorizeNetPopupGrayFrameTheme .AuthorizeNetPopupClose {
        position: absolute;
        right: 18px;
        top: 0;
        color: #ffffff;
    }

    .AuthorizeNetPopupGrayFrameTheme .AuthorizeNetPopupClose .fa-times {
        cursor: pointer;
        color: black;
    }

    .AuthorizeNetPopupGrayFrameTheme .AuthorizeNetPopupClose a {
        background-image: url('content/closeButton1.png');
        background-repeat: no-repeat;
        height: 16px;
        width: 16px;
        display: inline-block;
    }

    .AuthorizeNetPopupGrayFrameTheme .AuthorizeNetPopupClose a:hover {
        background-image: url('content/closeButton1h.png');
    }

    .AuthorizeNetPopupGrayFrameTheme .AuthorizeNetPopupClose a:active {
        background-image: url('content/closeButton1a.png');
    }

    .AuthorizeNetPopupGrayFrameTheme .AuthorizeNetPopupInner {
        background-color: #ffffff;
        border-width: 0;
        border-style: solid;
        border-color: #cfcfcf #ebebeb #ebebeb #cfcfcf;
    }

    .AuthorizeNetPopupGrayFrameTheme .AuthorizeNetPopupBottom {
        height: 30px;
    }

    .AuthorizeNetPopupGrayFrameTheme .AuthorizeNetPopupLogo {
        position: absolute;
        right: 9px;
        bottom: 4px;
        width: 200px;
        height: 25px;
        background-image: url('content/powered_simple.png');
    }

    .AuthorizeNetPopupSimpleTheme .AuthorizeNetPopupOuter {
        border: 1px solid #585858;
        background-color: #ffffff;
    }

    #iframeAuthorizeNet{
        width: 840px !important;
    }

    .popup-wrap {
        display: none;
    }

    .popup-wrap.open{
        display: block !important;
        position: fixed;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.36);
        top: 0;
        left: 0;
        z-index: 100;
    }

    .popup-wrap.open .popup-succ {
        position: fixed;
        width: 350px;
        height: 200px;
        background: white;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 4px;
    }
    .popup-wrap a{
        display: none;
    }
    .popup-wrap.open .popup-succ a.new-close{
        transform: rotate(45deg);
        font-weight: bold;
        font-size: 25px;
        display: flex;
        align-items: center;
        justify-content: center;
        line-height: 1;
        width: 25px;
        height: 25px;
        top: 6px;
        right: 6px;
        text-decoration: none;
        color: black;
        position: absolute;
    }

    #formAdnPayNowTitle{
        color: #2ca02c;
        display: block !important;
        font-size: 23px;
        position: relative;
        padding-left: 40px;
    }

    h2#formAdnPayNowTitle:before {
        content: "";
        width: 25px;
        height: 25px;
        background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOEAAADhCAMAAAAJbSJIAAAAjVBMVEX///8soCwAmAAVmxUnnyccnBwhnSEAmQAmnyYanBoUmxQMmgzU6NSAv4C93L2o0qg/pj93u3fu9u5UrVRKqkpjs2OMxYzi8OKYypj3+/dwuHDn8uc0ozSEwYT5/PlesV6y17LH4cep0qmTyJPc7dxNq008pTxWrlbP5s+fzZ+727t0unSDwIOXypdptmnkYwpKAAANeElEQVR4nO1d6UKrOhAuIVAghS50r9XWLrbeo+//eJe6dYGZTBaCx+PnT7XwNcnsM2m1fvGLX/wDGHSy7iZ9zfc8Fqxd/IiY7/PXdNPNOoOmX84Qi2w674m28OMgjDj3zuA8CoPYL37Xm0+zRdMvqoNBtsmF8IPwklcVeBj4QuSb7G9azlmWeiwJZNyueAYJ89Js1vSrU7A9DpkvXbnq1fTZ8LhtmgCOzjgSSmtXXksRjTtN04CweOEiMGD3iUB4L99R9qx2zAa9D5Jst2qa0DUWY+FH1vidEPnJ+Pss5GFkcfnOCNjo0DS1N6yHzO7ynRGx4bppeq2sJ0xkpwxc9JrluK6XX+Mct3nt/N44srwZM2DWZy74vXPsN2DPdUXoiN8Joeg65rfdJw75nZD0nG7VpbMNegZnS2f8Ol4dCl6OwHNkk48bWMB3cDZ2wG/Rixvid0Lcq91YXTW2gO/gbFUvwT5rlN8JrF8jv8G+GRFzjWBfW9CqY2qkcc6j4oebfoyoSaaudHcoD2NfCNYO74a7p4en3fAubDMh/FgrYHVCPYdxrEMwCpJ2kqfHrLO4tixni052TPPit4GOd1mH2pgrm2lRLJLRcY0fmsH6OEpErMwymdsmmCtqwTBho0eqJbl9HLFE0ZCPc6v87ntKzw9FvFR1W9fLWM1bCXv3FgnuFZ7NE5HqRZAOqUgUZE+4t0bx/o5+TEKWPxs86jln9C8zurNEUYFgwNKJ4dMmKT00aYni/Z5KMPanNp54P/WpYi2yslGpQib2jxae9o4jlWPYM39YTiMYtqfmz7rAtE18rrHSmJO+zIiltoNhs5QWSo8NVf+YZMkkQ1P5UoXJkPZwIwOOZGyHYmWJU+nxJBvAxAzvUAiKh/qitYMHQaGo7UwNCB/P2yuLjMpYtQlWjtB1iffyD4+HdReJDAiRL77X++y+3LZwEqRdys9KoBW7kUsZzjLbbCqRyeN7OtJmISUYenXoiMp38aQylanHUXuy7y3YWfTPJLjfyU4MVzbfxrLz7b/WQQXEqy95n1hR8Us1oUjrYQIilakuRa3oSfao2NREBMZGQpF7Kp+2lGx7y44EDdM2/lKBguraSvaoaIJgQVGyioyeJZYYMw1s0XdINipdnnZxr8V3LWTOSHGJmhDLGWb4NxW4VRPXeMUFhKC5OX3UgAh3NZPAscNfjmSf4mKGe+4smSrc43qMJGxy/CNc2aIQcHuZEwJTa/QUOvImMGQoRSZPKKAWd+yuaAfGEjOZ5Rojw5aQD10wkAJdBCFLeqH/3f4efS0DzHyTLSJ6CmuLGqpihb4lvohDZAnDB0cE5HhAtCJ+lA6YnCIaDC6AxjlRR3GEpAqSlav3J2CFmM7RCP4/TJtG30OOfmKIrAUSlRojdm3jxsw1MNsygEM2yO4Om3OZqoH5BwL6pxXifbWbEDMHBivgGaIUfahYYgeririJuMWBRQFMcQobbxHg4WFyxq+JBIY1OxX9wRSRHQcIjRdYzsT2ihDIWL994TwCKR7hRQxeKv8DMWcaWML1x46KOEgRC9pU/X0HlqSB+1N49gK5Bwm5KbzpKmtsEWXInEcuLt3cCKI4gwVHpUqEjQT3uvD56t2jO4BiCuvEqPzXW3iTOjdnnm8WB6pfm8CLKMohqSO4SSnRHasoZ58hinDULChLf9gzTEzKKTVQlV4HakmfQXFa9hKRUwtaefXgsfJNgIpg5Gjdnt0M/DYcy5ku8FVXVyHCssa/jXvCfyqcNsVDBAuKVQ7qAVzE0sLAwfLYBbFPHBHbuJIiaLndpoQH8FfnMgiMEaxOCi3BvXfjeWVg3CNx2A0vzWOXKR7gF78+iBtQGzJX9ArnRlqkFJRVM/g/wXWmGlSdWODKMmTFFm/fd8miBsODN4YK+OHxoyuCYy2CrUdQ1lzp8QX46RX2XXME2xUvA9vT4tKchvV94ojgUpNgqwWKmiudD/qSro7hHzlBDmwn8CBe+e1zSKtUmOh1IJVX5XMB+HCgUxRe9imAWUM32rBPIJhATuoa+uerTCK4R5zkRI0IthagmXAhTOGkqgtB85+sdLQg6CMlwOD3c7E8YJjNhXs/JxCMsRpn0Fq5CLiBysKBbygt/j2NGkTPCuj4XaiLLmQX1B/rfiV0UyCR/RPA2Hd8LuQD7e6So2wbIznBCI7rvwPcgRe2N7jOtPEM+oYdgSCHo/ofAKXIxRl7hcwCQeli2DLdeswHwgp6Un01gRhG5/cCpVEpYFWBDvN8vS7HB3nbERjRvwAYJozOmgCsem7LX/OtQMXX6Tt6IhCE4vlXgLT5RcMXGIUKpZ/+kQRL1NVKbotgC47Wf/0JdBz4HZFgQVE1YCXt8ym+XxrB1h20QsHXn4AmjayG5iIJJtS6cigEqc32YELibJhCR5VLarqvMgxKPQpDeYMvfbIHWGFxjqJBRzV6ohMsPo+eKSYRJH/aE6TszoISXEO0GrGUQmFEG48yC6YywA3goaY1rIhPM1JgzjZBozVEzuG06p8ozaqUYTcVwW0EhHOoIUs31d8Kk2ZTZ3e2CVJkqbo+BKObsnaFGWHYTUXsHgVBHyrbNEh0k6Gxq5lHIIhL8DIINo2qXYoG/zCKJILK5eQEu1TRt5DExuC2lYGs+bZArEyQ4luo+YfS0BFUSj4gDEyM1YPsFP9QyccHpOgVxUqvfxDJt6gGQZKPrxanITiuVTmUAWEOZKwTLaDEaRRjbQTXtZxkWBDuLtGbYkCJtanGS/FGzhP47QlexASCesEQSrxUOeYt9w1u4vALn0DwPy2CpJi3et5Cbjzz+CJItiDMQ0x05wNT8hbquSeC+XwRqp4QxvNqEyTlnjTyh4RhihGfKRDUzpDQ8ocaOWCCCf0RKtsSCIo/ugSJOWCdPD7BxnwrfN1KCp3eCBqUltHy+Fq1GAQVHu5pBE3G5tFqMfTqaQZyJR4OCcNIjQgS62k0a6IIWo4yT85oVAqxJkq3rm1h4SodVt3BQwW1rk23NhH0XMgwHVdErU3Uri+lCBIM1BgrBHJ9qX6NsGziUr0EW3+oNcIGdd6kEaDQWxjfcUSu8zap1Ueb+HGCxsWrCrX6Jv0Wa02K5gRV+i2Memb0KNq4pEKhZ8as7wmfilMfQZW+J8Petdt+OgJBG/1iOWj8VzhFhv2Hqle0WCGo1n9o2kNa3XIGErRSTqbWQ2rcB4x39NRBULUP2LiXuzJnWk3QTm21ai93C3klWj8+penFIkHlfnwLMxUoXSH2CKrPVLAwF2NJmPVPmBlHAzYXA6ip3MHilDrbRN44YY3gi/psEyvzafqS5KL+lP8baM2ngcNWCjXteP7UGkG9GUP4nChqrTNWm17dm6UDzTlRdmZ9wcXb9giio/OwCfR25rUBSWKo+UwHj5rz2iQz98g9UJVJYrD5TAP6M/dszU2sSBLbJGgwN9Ha7MtSkhhpPlOHyexLa/NLb5LEaPOZKuDQp0cYQosuosIlEtdJYrz5TBVmM2itzRG+TBJLms8UYThHWBI3U3BdZ19BZlnzmRqMZ0HL5nnTt9uMv6+itPlMCUhsxiO2hNqbyf6eJJY3n6ngHq/+o9mW9ubqn5LEhOYzFdiYq2/zboSFHxKazxRg524Em/dbTOwStHS/hfSup8buKJHEgRTU9c+/Z+bn3xX0Le97koUq1e57+gfu7Pr77l3zlQurfvzdeaT7D226RBgmvI77D3/+HZb/wD2ktLtke9/iLlnd+8e/xX3A8h1qcB8w9U7n+pax7judG7+X+7H2e7npd6vXMXtw6+Ju9VZrLj/nBSLWt33/xaxPOYGFrNNrlrpATtkoxVa17G68tInPtTCNjDAf4P3L9O2NzTr6pK2jNFsCxv1e3vr5yXFqY6/OpgmRnxdRx5/gILQ4fSJgqWkCZpIyQovGB0FgGL0yFCh6IctNavKynBEPhU2CtFEWX+C+SPUqSg6p8OnfJX1CD4kiVdx8PFvES1WShz8xSb+fH0Ke0ENDTj38n89P2OiRagdsH0csUaJXiDXrQyvnJAPjElEsktFxjbumi/VxlIhYYXO+IzFW9GWMdcrVoyBpJ3l6zDqTa0Uym3SyY5oXvw2U2RVghqZaNVQLnb/Aw9gXgrWDu+Hu6eFpN7wL2kwIPybMIAAIruogeKqxNexU45xHxQ9hPAb+MbSBlToY7MnKuEYEtcYV+kZ9XFbAdNvaiSBFFWoEr+sInrEgRIbqg99zEaMdN7aMvB4lUUbHa0bgBF5tMrSEZQPLyJ2En7+w7SkbcYZIeq5u2vhEV80TMEQojPtp1UENhlkAtx/Ko2GbO+HIWd7cbcuHnoWhChJ+ouf0WrQS1vVyLPg5vFEL4jhkOh4eBREbNs/vhMOIHgBUQMBG7jS8DIuxUpSMgMgXY1dlAkQ87ywuZMB2jq8GJWHx4gkbJAPhvXyz5TujM44EYT4iDB6IaPx9Tl8ltsch87VCTDz02fDo2vrUwixLPZYorSUPEualWTO2mR4G2SYXwg+kq8nDwBci32Qu7s6yjkk2nfdEW/hxEEbRJVceRWEQ+8XvevNp1pzZaQeDTtbdpK/5vhAjrF38FMJon7+mm27W+SsX7he/+IUq/gfhXN5TbD9c6QAAAABJRU5ErkJggg==);
        display: block;
        position: absolute;
        left: -4px;
        top: 1px;
        background-size: contain;
    }

</style>


<div class="popup-wrap">
    <div class="popup-succ ">
        <a href="#" class="new-close">+</a>
        <h2 id="formAdnPayNowTitle" style="color: green; display: block !important"></h2>
    </div>
</div>

<form method="post" action="https://accept.authorize.net/payment/payment" id="formAuthorizeNetPopup"
      name="formAuthorizeNetPopup" target="iframeAuthorizeNet" style="display:none;">
    <input type="hidden" id="popupToken" name="token" value=""/>
</form>
{#
<input type="text" id="inputtoken" value="{{ token }}"/>

<br/>

<div>
    Trigger Accept Transaction
    <button id="btnOpenAuthorizeNetPopup" onclick="AuthorizeNetPopup.openPopup()">Open AuthorizeNetPopup</button>
</div>
#}
<div id="divAuthorizeNetPopup" style="display:none;" class="AuthorizeNetPopupGrayFrameTheme">
    <div class="AuthorizeNetPopupOuter">
        <div class="AuthorizeNetPopupTop">
            <div class="AuthorizeNetPopupClose">
                <i class="fa fa-times" aria-hidden="true" onclick="AuthorizeNetPopup.closePopup();" title="Close"></i>
            </div>
        </div>
        <div class="AuthorizeNetPopupInner">
            <iframe name="iframeAuthorizeNet" id="iframeAuthorizeNet" src="{{ url('auth_inner_popup') }}" frameborder="0"
                    scrolling="no"></iframe>
        </div>
        <div class="AuthorizeNetPopupBottom">
            <div class="AuthorizeNetPopupLogo" title="Powered by Authorize.Net"></div>
        </div>
        <div id="divAuthorizeNetPopupScreen" style="display:none;"></div>
    </div>
</div>

<script type="text/javascript">
    (function () {
        if (!window.AuthorizeNetPopup) window.AuthorizeNetPopup = {};
        if (!AuthorizeNetPopup.options) AuthorizeNetPopup.options = {
            onPopupClosed: null
        };

        AuthorizeNetPopup.closePopup = function () {
            document.getElementById("divAuthorizeNetPopupScreen").style.display = "none";
            document.getElementById("divAuthorizeNetPopup").style.display = "none";
            document.getElementById("iframeAuthorizeNet").src = "{{ url('auth_inner_popup') }}";
            /*document.getElementById("btnOpenAuthorizeNetPopup").disabled = false;*/
            if (AuthorizeNetPopup.options.onPopupClosed) AuthorizeNetPopup.options.onPopupClosed();
        };


        AuthorizeNetPopup.openPopup = function (orderId) {
            window.orderId=orderId;
            var popup = document.getElementById("divAuthorizeNetPopup");
            var popupScreen = document.getElementById("divAuthorizeNetPopupScreen");
            var ifrm = document.getElementById("iframeAuthorizeNet");
            var form = document.forms["formAuthorizeNetPopup"];
            getTokenAuth(orderId);
           /*
            console.log(window.avtorizeToken);
            */
          /*
            $("#popupToken").val($("#inputtoken"+orderId).val());
            */
            $("#popupToken").val(window.avtorizeToken);
            form.action = "https://accept.authorize.net/payment/payment";
            ifrm.style.width = "884px";
            ifrm.style.height = "650px";

            form.submit();

            popup.style.display = "";
            popupScreen.style.display = "";
            centerPopup();
        };

        AuthorizeNetPopup.onReceiveCommunication = function (querystr) {
            var params = parseQueryString(querystr);
            console.log(params);
            switch (params["action"]) {
                case "successfulSave":
                    AuthorizeNetPopup.closePopup();
                    $('.popup-wrap h2').text('{{ 'Successful payment' | trans }}');
                    $('.popup-wrap').toggleClass('open');
                    setTryPaid();
                    setTimeout(function () {
                        $('.popup-wrap').removeClass('open');
                        window.location.reload()
                    }, 3000);
                    break;
                case "cancel":
                    AuthorizeNetPopup.closePopup();
                    break;
                case "transactResponse":
                    var response = params["response"];
                    // document.getElementById("token").value = response;
                    AuthorizeNetPopup.closePopup();
                    $('.popup-wrap h2').text('{{ 'Successful payment' | trans }}');
                    $('.popup-wrap').toggleClass('open');
                    setTryPaid();
                    setTimeout(function () {
                        $('.popup-wrap').removeClass('open');
                        window.location.reload()
                    }, 3000);
                    break;
                case "resizeWindow":
                    var w = parseInt(params["width"]);
                    var h = parseInt(params["height"]);
                    var ifrm = document.getElementById("iframeAuthorizeNet");
                    ifrm.style.width = w.toString() + "px";
                    ifrm.style.height = h.toString() + "px";
                    centerPopup();
                    break;
            }
        };

function setTryPaid() {
    var datastr="id="+window.orderId;
    $.ajax({
        url: '/authorize-dot-net/try-paid',
        type: 'POST',
        data: datastr,
        success: function(mess) {

            console.log(mess);
        },
        error:function(mess) {
            console.log(mess);
        }
    })
}

        function getTokenAuth(id) {
            var datastr="invoice-id="+id;
            $.ajax({
                url: '/authorize-dot-net/ajax/get-token-to-form',
                type: 'POST',
                data: datastr,
                async: false,
                success: function(mess) {
                  /*  console.log(mess);*/
                    window.avtorizeToken=mess;
                   return mess;
                },
                error:function(mess) {
                    return null;
                }
            })
        }

        function centerPopup() {
            var d = document.getElementById("divAuthorizeNetPopup");
            d.style.left = "50%";
            d.style.top = "50%";
            d.style.transform = "translate(-50%, -50%)";
            // var left = -Math.floor(d.clientWidth / 2);
            // var top = -Math.floor(d.clientHeight / 2);
            // d.style.marginLeft = left.toString() + "px";
            // d.style.marginTop = top.toString() + "px";
            d.style.zIndex = "2";
            d.style.visibility = "initial";
            // if (d.offsetLeft < 16) {
            //     d.style.left = "16px";
            //     d.style.marginLeft = "0px";
            // }
            // if (d.offsetTop < 16) {
            //     d.style.top = "16px";
            //     d.style.marginTop = "0px";
            // }
        }

        function parseQueryString(str) {
            var vars = [];
            var arr = str.split('&');
            var pair;
            for (var i = 0; i < arr.length; i++) {
                pair = arr[i].split('=');
                vars.push(pair[0]);
                vars[pair[0]] = unescape(pair[1]);
            }
            return vars;
        }
    }());

</script>
